---
title: "Vim ã§ auth-source ãƒ©ã‚¤ã‚¯ãªãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ç§˜åŒ¿ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚’ä½œã£ãŸ"
emoji: "ğŸ”‘"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ['vim', 'pgp', 'emacs', 'pass']
published: true
---

ã“ã®è¨˜äº‹ã¯ [Vim ã§ auth-source ãƒ©ã‚¤ã‚¯ãªãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ç§˜åŒ¿ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚’ä½œã£ãŸ - Qiita](https://qiita.com/tsuyoshi_cho/items/a610272027ad3ec35352) ã¨åŒã˜ã‚‚ã®ã§ã™ã€‚

----

# vim-pass

<a href="https://github.com/tsuyoshicho/vim-pass"><img src="https://github-link-card.s3.ap-northeast-1.amazonaws.com/tsuyoshicho/vim-pass.png" width="460px"></a>

ä»¥å‰ã‹ã‚‰ã€gpgæ´»ç”¨ã®ã²ã¨ã¤ã¨ã—ã¦ [Pass: The Standard Unix Password Manager](https://www.passwordstore.org/) ã®ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã‚’ä½¿ã£ã¦ã„ã¾ã—ãŸã€‚

ãã‚Œã¨ã¯åˆ¥ã¨ã—ã¦Emacsã§ã¯ã€è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«å†…ã®ç§˜åŒ¿æƒ…å ±ã«ã¤ã„ã¦`auth-source`ã§æš—å·åŒ–ã§ãã‚‹ã—ãã¿ãŒã‚ã‚Šã€æœ‰ç”¨æ€§ã‚’æ„Ÿã˜ã¦ã„ã¾ã—ãŸã€‚(ã“ã¡ã‚‰ã¯å°‚ç”¨ã®ãƒ•ã‚¡ã‚¤ãƒ«ã«æš—å·åŒ–ã—ã¦ä¿å­˜ã™ã‚‹)

çµæœã€Vimã§(ç›®æ¨™ã¯)password-storeå½¢å¼ã®ãƒ‡ãƒ¼ã‚¿ã®APIã‚’æ•´å‚™ã—ã¤ã¤ã€`auth-source`ã®åˆ©ä¾¿æ€§ã‚’æŒã¡è¾¼ã‚‚ã†ã¨ã—ã€ãã®çµæœã¨ãªã‚Šã¾ã™ã€‚

ã¾ã ã¾ã ä¸å…·åˆã ã‚‰ã‘ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ãŒ(ç‰¹ã«ç•°å¸¸ç³»ã¯ã‚ã¾ã‚Šè©¦ã›ã¦ãªã„ã€CIã¨ãƒ†ã‚¹ãƒˆãªã„ã—â€¦â€¦)ã€ã©ã†ãã‚ˆã‚ã—ãã€‚

## ç”¨æ³•

READMEå‚ç…§ã€‚

```vim
" in vimrc
" configured at end of vim startup
call pass#get_startup('g:test_gh_token','Develop/Github')
call pass#get_startup('g:test_gh_username','Develop/Github','username')

function! test() abort
  let password = pass#get('Service/foobar')
  " â€¦â€¦
endfunction
```

```toml
# in plugin setting(dein's toml)
[[plugins]]
repo = 'tsuyoshicho/vim-pass'

[[plugins]] # https://pixe.la/
repo = 'mattn/vim-pixela'
depends = ['open-browser.vim','vim-pass']
hook_add = '''
  " let g:pixela_username = 'user'
  " let g:pixela_token    = 'token'

  call pass#get_startup('g:pixela_username','Develop/Pixela','username')
  " VimPixela work OK
  call pass#get_startup('g:pixela_token','Develop/Pixela')
  " startup-time countup do not correct work.
  " It work or does not work depending on the processing order of events
'''

[[plugins]] # Slack
repo = 'mizukmb/slackstatus.vim'
depends = ['webapi-vim','vim-pass']
hook_add = '''
  " let g:slackstatus_token = '<YOUR_SLACK_TOKEN>'
  " my hoge
  call pass#get_startup('g:slackstatus_token','Message/Slack/myhoge.legacy')
  " vim-jp
  " call pass#get_startup('g:slackstatus_token','Message/Slack/vim-jp.legacy')
  "
  function! s:slack_list(A,L,P) abort
    let slacklist = ['myhoge','vim-jp']
    return slacklist
  endfunction

  function s:slackstatus_change_token(team) abort
    let path = 'Message/Slack/' . a:team . '.legacy'
    let g:slackstatus_token = pass#get(path)
  endfunction

  command! -nargs=1 -complete=customlist,<SID>slack_list SlackStatusChange :call <SID>slackstatus_change_token(<f-args>)
'''

```

èµ·å‹•æ™‚ã«ãƒ‘ã‚¹ãƒ•ãƒ¬ãƒ¼ã‚ºã®ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰å…¥åŠ›ã‚’Vimä¸Šã§ã¯ã§ãã¾ã›ã‚“ã®ã§ã€èµ·å‹•å¾Œã«ã¾ã¨ã‚ã¦è¨­å®šã™ã‚‹`pass#get_setup`ã‚’ç”¨æ„ã—ã¾ã—ãŸã€‚
é€šå¸¸ä½¿ã„ã«ã¯`pass#get`ãŒã‚ã‚Šã¾ã™ã€‚
ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ãƒ¢ãƒ¼ãƒ‰ã‚’æ¨ã¦ã€gpgã®pinentryä»»ã›ãªã‚‰ã“ã®æ‰‹é–“ã¯ãªãã¦ã‚ˆã„ã®ã§ã™ãŒâ€¦â€¦ã€ãã‚Œã‚„ã‚‹ã¨é…·ã„ã“ã¨ã«ãªã‚Šã¾ã™ã‹ã‚‰ã­ã€‚

## åˆ¶é™
ãªãŠã€ãƒªãƒ¢ãƒ¼ãƒˆã§ã¯å¼·åˆ¶ã§pinentryãªã—ç’°å¢ƒã®è¨­å®šã«ã—ã¦ã„ã¾ã™ãŒã€ãƒ­ãƒ¼ã‚«ãƒ«ã‹ã¤non-GUIãªç’°å¢ƒã ã¨æ‰‹å‹•è¨­å®šã—ãªã„ã¨æ‚²æƒ¨ãªã“ã¨ã«ãªã‚‹ã¨æ€ã„ã¾ã™ã€‚(æœªãƒ†ã‚¹ãƒˆ)

ä»–ã«ã‚‚ã€
- ç›®æ¨™ã¯ååˆ†ãªæ“ä½œAPIã ã‘ã©ã€ç¾çŠ¶ã¯getã®ã¿
- Vimãƒ¬ã‚¸ã‚¹ã‚¿ã«è»¢å†™ã—ã€ä¸€å®šæ™‚é–“å¾Œã«æ¶ˆæ»…ã™ã‚‹APIã‚’è€ƒãˆã¦ã„ã¾ã™ãŒã€ã“ã‚Œã‚‚æœªæ•´å‚™
- ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆé …ç›®ã®ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ä»¥å¤–ã‚’æŒ‡å®šã—ãŸå ´åˆã«ã¤ã„ã¦ã€ãã®é …ç›®ã®ç¢ºèªã¯æ–‡å­—åˆ—æ¯”è¼ƒ(exact match)
- èµ·å‹•æ™‚ã«ï½ã¨è¨€ã„ãªãŒã‚‰ã€èµ·å‹•æ™‚ã«å€¤ãŒè¨­å®šã•ã‚Œã¦ã„ã‚‹ã“ã¨ãŒå¿…è¦ãªãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã®è¨­å®šå€¤ã«ã¤ã„ã¦VimEnterã®ã‚¤ãƒ™ãƒ³ãƒˆå‡¦ç†ã®é †åºã«ã‚ˆã£ã¦ã¯ã€æœŸå¾…ã™ã‚‹å‹•ä½œã‚’ã—ãŸã‚Šã—ãªã‹ã£ãŸã‚ŠãŒã‚ã‚‹(åˆ¥é€”APIä½œæˆã«ã‚ˆã‚Šè§£æ±ºæ¸ˆã¿)

ã¨åˆ¶é™ã¦ã‚“ã“ã‚‚ã‚Šã§ã™ã€‚

## ã‚ã¨ãŒã
ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ã‚’ã©ã‚Œã ã‘ãŒã‚“ã°ã‚Œã‚‹ã‹ã‚ã‹ã‚‰ãªã„ã®ã§ã€æ´¾ç”Ÿå¤§æ­“è¿ã€‚

